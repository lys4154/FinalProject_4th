<?xml version="1.0" encoding="UTF-8"?>

	<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="project.dao.ProjectDAO">



<select id="getProjectsByMemberSeq" parameterType="int" resultType="projectdto">
	select * from project where member_seq=#{memberSeq}
</select>

<select id="getAllProjects" resultType="projectdto">
    select * from project where
</select>

<select id="getAllApprovedProjects" resultType="projectdto">
    select * from project where project_process=3
</select>

<select id="getAllUnapprovedProjects" resultType="projectdto">
    select * from project where project_process=1
</select>

<select id="approvedCount" resultType="int">
    select count(*) from project where project_process=3
</select>

<select id="unapprovedCount" resultType="int">
    select count(*) from project where project_process=1
</select>




<!-- 후원한 프로젝트 페이지 - 후원 진행중 -->
<select id="ongoingProject" parameterType="java.util.List" resultType="projectdto">
    SELECT * FROM project
    WHERE project_seq IN
    <foreach collection="list" item="item" open="(" separator="," close=")">
        #{item}
    </foreach>
</select>


<!-- 후원한 프로젝트 페이지 - 후원 성공 -->
<select id="successProject" parameterType="java.util.List" resultType="projectdto">
    SELECT * FROM project
    WHERE project_seq IN
    <foreach collection="list" item="item" open="(" separator="," close=")">
        #{item}
    </foreach>
</select>


<!-- 후원한 프로젝트 페이지 - 후원 취소 -->
<select id="cancelProject" parameterType="java.util.List" resultType="projectdto">
    SELECT * FROM project
    WHERE project_seq IN
    <foreach collection="list" item="item" open="(" separator="," close=")">
        #{item}
    </foreach>
</select>


<!-- 후원한 프로젝트 페이지 - 검색 -->
<select id="searchFunded" parameterType="java.util.Map" resultType="projectdto">
	SELECT * FROM project
	WHERE (long_title LIKE concat("%", #{searchKeyword, jdbcType=VARCHAR}, "%")
	OR short_title LIKE concat("%", #{searchKeyword, jdbcType=VARCHAR}, "%"))
	AND  member_seq=#{memberSeq, jdbcType=INTEGER}	
</select>



<!-- 후원한 프로젝트 페이지 -> 후원 내역 상세 -->	
<select id="getProjectDetail" parameterType="int" resultType="projectdto">
	select * from project where project_seq=#{projectSeq}
</select>	

<!-- tab_info저장 -->
<insert id="insertProject" parameterType="project.dto.ProjectDTO">
 INSERT INTO project (long_title, short_title, sub_title, main_images_url, url, category)
 VALUES (#{long_title}, #{short_title}, #{sub_title}, #{main_images_url}, #{url}, #{category})
</insert>


<!-- 관심 프로젝트 전체 -->
<select id="myDibsProject" parameterType="java.util.List" resultType="projectdto">
    SELECT * FROM project
    WHERE project_seq IN
    <foreach collection="list" item="item" open="(" separator="," close=")">
        #{item}
    </foreach>
</select>

<!-- 관심 프로젝트 진행중 -->
<select id="dibsOngoing" parameterType="java.util.List" resultType="projectdto">
    SELECT * FROM project
    WHERE project_seq IN
    <foreach collection="list" item="item" open="(" separator="," close=")">
        #{item}
    </foreach>
    AND due_date > CURRENT_DATE
</select>


<select id="getAllApprovedProjectsOrderByStartDate" resultType="projectdto">
    select * from project where approval_status=true order by start_date desc
</select>


<!-- 관심 프로젝트 종료된 -->
<select id="dibsEnd" parameterType="java.util.List" resultType="projectdto">
    SELECT * FROM project
    WHERE project_seq IN
    <foreach collection="list" item="item" open="(" separator="," close=")">
        #{item}
    </foreach>
    AND CURRENT_DATE > due_date
</select>



<!-- 마이프로필 - 팔로워의 올린프로젝트 찾기 -->
<select id="getProjectCount" resultType="int">
	SELECT COUNT(*) FROM project WHERE member_seq = #{followerSeq}
</select>


<!-- 관심 프로젝트 - 관심 취소 -->
<update id="dibsDelete" parameterType="int">
	UPDATE project
	SET dibs_count = dibs_count - 1
	WHERE project_seq = #{projectSeq}
</update>



</mapper>